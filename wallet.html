<!DOCTYPE html>
<html>

<head>

<meta name="viewport"
content="width=device-width,initial-scale=1">

<title>CreatorHub Wallet</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>

/* DEVICE AUTO THEME */

:root{
--bg:#ffffff;
--text:#111827;
--card:#f3f4f6;
--accent:#22c55e;
}

@media (prefers-color-scheme:dark){

:root{
--bg:#020617;
--text:#ffffff;
--card:#111827;
}

}

body{
margin:0;
font-family:Arial;
background:var(--bg);
color:var(--text);
}

/* HEADER */

.topbar{
display:flex;
align-items:center;
padding:14px;
background:var(--bg);
box-shadow:0 4px 15px rgba(0,0,0,.3);
position:sticky;
top:0;
z-index:99;
}

/* BACK BUTTON */

.back{
font-size:22px;
cursor:pointer;
width:40px;
}

/* TITLE */

.title{
flex:1;
text-align:center;
font-weight:bold;
color:var(--accent);
font-size:18px;
}

</style>

<style>

body{
margin:0;
font-family:Arial;
background:
linear-gradient(
180deg,#020617,#111827
);
color:white;
padding:15px;
}

/* HEADER */

.header{
display:flex;
gap:10px;
align-items:center;
margin-bottom:20px;
}

.back{
background:#2563eb;
padding:10px 18px;
border:none;
border-radius:10px;
color:white;
cursor:pointer;
}

/* CARD */

.card{
background:
rgba(31,41,55,.9);
padding:20px;
border-radius:18px;
margin-bottom:18px;
box-shadow:
0 10px 25px rgba(0,0,0,.5);
}

/* BALANCE */

.balance{
font-size:32px;
font-weight:bold;
color:#22c55e;
margin-top:10px;
}

/* INPUT */

input{
width:100%;
padding:14px;
margin-top:12px;
border:none;
border-radius:10px;
background:#020617;
color:white;
outline:none;
}

/* BUTTON */

button{
width:100%;
padding:15px;
margin-top:15px;
border:none;
background:
linear-gradient(
90deg,#22c55e,#4ade80
);
border-radius:12px;
font-weight:bold;
color:white;
cursor:pointer;
}

.item{
background:#020617;
padding:12px;
border-radius:10px;
margin-top:8px;
display:flex;
justify-content:space-between;
}

canvas{
background:#020617;
border-radius:10px;
padding:10px;
}

</style>

</head>

<body>

<div class="topbar">

<div class="back"
onclick="goBack()">

‚¨Ö

</div>

<div class="title">

CreatorHub

</div>

</div>


<div class="header">

<button class="back"
onclick="history.back()">

‚¨Ö Back

</button>

<h2>
üí∞ Creator Wallet
</h2>

</div>



<!-- BALANCE -->

<div class="card">

<h3>
üí∏ Available Balance
</h3>

‚Çπ
<span id="balance"
class="balance">
0
</span>

</div>



<!-- WITHDRAW -->

<div class="card">

<h3>
Withdraw Money (UPI)
</h3>

<input id="upi"
placeholder="Enter UPI ID">

<input id="amount"
placeholder="Withdraw Amount ‚Çπ">

<button onclick="withdraw()">
Withdraw Request üöÄ
</button>

</div>



<!-- GRAPH -->

<div class="card">

<h3>
üìä Earnings Chart
</h3>

<canvas id="chart">
</canvas>

</div>



<!-- HISTORY -->

<div class="card">

<h3>
üìú Transaction History
</h3>

<div id="history">
Loading...
</div>

</div>



<script>

// BACK FUNCTION

function goBack(){
history.back();
}


// ‚≠ê‚≠ê‚≠ê GOOGLE DRIVE API ‚≠ê‚≠ê‚≠ê

const API=
"https://script.google.com/macros/s/AKfycbw7xwjcEGIdj3xS8q7qhRNCSbch2uVsXFGFJYWgMNU4UPA-2BSfhq79PHsQ_oCEeYTm/exec";


// LOGIN CHECK

let user=
JSON.parse(
localStorage.getItem("user")
);

if(!user){
alert("Login First");
location.href="login.html";
}


// DRIVE LOAD

async function getDB(db){
const res=
await fetch(
API+"?db="+db
);
return await res.json();
}


// DRIVE SAVE

async function saveDB(db,data){
await fetch(
API,
{
method:"POST",
body:JSON.stringify({
db:db,
data:data
})
});
}


let balance=0;


// LOAD WALLET ‚≠ê‚≠ê‚≠ê

async function loadWallet(){

let wallets=
await getDB("wallets");

balance=
wallets[user.email] || 0;


// BALANCE ANIMATION

let show=0;
let el=
document.getElementById("balance");

let anim=
setInterval(()=>{
show+=Math.ceil(balance/20);
if(show>=balance){
show=balance;
clearInterval(anim);
}
el.innerText=show;
},40);


// TRANSACTIONS

let tx=
await getDB("transactions");

let my=
tx.filter(
t=>t.user===user.email
);

let box=
document.getElementById("history");

if(!my.length){
box.innerHTML=
"No Transactions";
}else{

box.innerHTML="";

my.reverse()
.forEach(h=>{
box.innerHTML+=`
<div class="item">
<div>
‚Çπ ${h.amount}
</div>
<div>
${h.status}
</div>
</div>
`;
});
}


// GRAPH

new Chart(
document.getElementById("chart"),
{
type:"line",
data:{
labels:
my.map((_,i)=>
"Tx "+(i+1)
),
datasets:[{
label:"Earnings",
data:
my.map(
t=>t.amount
),
borderWidth:2
}]
}
});

}

loadWallet();


// WITHDRAW ‚≠ê‚≠ê‚≠ê FINAL

async function withdraw(){

let amount=
document.getElementById("amount").value;

let upi=
document.getElementById("upi").value;

if(!amount||!upi){
alert("Fill Details");
return;
}

amount=
Number(amount);

if(balance<amount){
alert("Low Balance");
return;
}


// LOAD DRIVE

let wallets=
await getDB("wallets");

let tx=
await getDB("transactions");

let withdraws=
await getDB("withdraws");


// CUT BALANCE

wallets[user.email]-=amount;


// HISTORY ADD

tx.push({
user:user.email,
amount:amount,
status:"Withdraw Pending",
time:
new Date().toLocaleString()
});


// WITHDRAW REQUEST

withdraws.push({
user:user.email,
amount:amount,
upi:upi,
status:"Pending",
time:
new Date().toLocaleString()
});


// SAVE DRIVE

await saveDB(
"wallets",
wallets
);

await saveDB(
"transactions",
tx
);

await saveDB(
"withdraws",
withdraws
);


// OPEN UPI APP

window.location.href=
"upi://pay?pa="+upi+
"&pn=CreatorHub&am="+amount+
"&cu=INR";

alert(
"Withdraw Request Sent ‚úÖ"
);

location.reload();

}

</script>

</body>

</html>
