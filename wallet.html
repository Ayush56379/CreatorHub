<!DOCTYPE html>
<html lang="en">
<head>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">

<title>CreatorHub Wallet</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>

/* ================= THEME ================= */

:root{
--bg:#ffffff;
--text:#111827;
--card:#f3f4f6;
--accent:#22c55e;
}

@media(prefers-color-scheme:dark){
:root{
--bg:#020617;
--text:#ffffff;
--card:#111827;
}
}

body{
margin:0;
font-family:Arial;
background:var(--bg);
color:var(--text);
}


/* ================= HEADER ================= */

.topbar{
display:flex;
align-items:center;
padding:14px;
background:var(--bg);
box-shadow:0 5px 20px rgba(0,0,0,.3);
position:sticky;
top:0;
z-index:999;
}

.back{
font-size:22px;
cursor:pointer;
width:40px;
}

.pageTitle{
flex:1;
text-align:center;
font-size:18px;
font-weight:bold;
color:var(--accent);
}

.dashboard{
background:var(--accent);
padding:8px 14px;
border-radius:20px;
font-size:13px;
color:white;
text-decoration:none;
}


/* ================= CONTAINER ================= */

.container{
padding:18px;
}


/* ================= CARD ================= */

.card{
background:var(--card);
padding:18px;
border-radius:16px;
margin-bottom:18px;
box-shadow:0 8px 25px rgba(0,0,0,.25);
}

.balance{
font-size:34px;
font-weight:bold;
color:var(--accent);
margin-top:10px;
}


/* ================= INPUT ================= */

input{
width:100%;
padding:14px;
margin-top:12px;
border:none;
border-radius:10px;
background:rgba(0,0,0,.05);
color:var(--text);
outline:none;
font-size:14px;
}


/* ================= BUTTON ================= */

button{
width:100%;
padding:14px;
margin-top:15px;
border:none;
background:linear-gradient(90deg,#22c55e,#4ade80);
border-radius:12px;
font-weight:bold;
color:white;
cursor:pointer;
}


/* ================= HISTORY ================= */

.item{
background:rgba(0,0,0,.05);
padding:12px;
border-radius:10px;
margin-top:8px;
display:flex;
justify-content:space-between;
font-size:14px;
}


/* ================= CHART ================= */

canvas{
background:rgba(0,0,0,.05);
border-radius:10px;
padding:10px;
}

.empty{
opacity:.7;
margin-top:20px;
}

</style>

</head>

<body>

<!-- HEADER -->

<div class="topbar">
<div class="back" onclick="history.back()">â¬…</div>
<div class="pageTitle">ðŸ’° Creator Wallet</div>
<a class="dashboard" href="dashboard.html">Dashboard</a>
</div>


<div class="container">

<!-- BALANCE -->

<div class="card">
<h3>Available Balance</h3>
â‚¹ <span id="balance" class="balance">0</span>
</div>


<!-- WITHDRAW -->

<div class="card">
<h3>Withdraw Money (UPI)</h3>
<input id="upi" placeholder="Enter UPI ID">
<input id="amount" placeholder="Withdraw Amount â‚¹" type="number">
<button onclick="withdraw()">Withdraw Request ðŸš€</button>
</div>


<!-- GRAPH -->

<div class="card">
<h3>ðŸ“Š Earnings Chart</h3>
<canvas id="chart"></canvas>
</div>


<!-- HISTORY -->

<div class="card">
<h3>ðŸ“œ Transaction History</h3>
<div id="history">Loading...</div>
</div>

</div>


<script>

const API="https://script.google.com/macros/s/AKfycbw7xwjcEGIdj3xS8q7qhRNCSbch2uVsXFGFJYWgMNU4UPA-2BSfhq79PHsQ_oCEeYTm/exec";


let user=JSON.parse(localStorage.getItem("user"));

if(!user){
alert("Login First");
location.href="login.html";
}


/* DATABASE */

async function getDB(db){
const res=await fetch(API+"?db="+db);
return await res.json();
}

async function saveDB(db,data){
await fetch(API,{
method:"POST",
body:JSON.stringify({db,data})
});
}


let balance=0;


/* LOAD WALLET */

async function loadWallet(){

let wallets=await getDB("wallets");
balance=wallets[user.email]||0;


/* BALANCE ANIMATION */

let show=0;
let el=document.getElementById("balance");

let anim=setInterval(()=>{
show+=Math.ceil(balance/20)||1;
if(show>=balance){
show=balance;
clearInterval(anim);
}
el.innerText=show;
},40);


/* TRANSACTIONS */

let tx=await getDB("transactions")||[];
let my=tx.filter(t=>t.user===user.email);

let box=document.getElementById("history");

if(!my.length){
box.innerHTML="<div class='empty'>No Transactions</div>";
}else{

box.innerHTML="";
my.reverse().forEach(h=>{
box.innerHTML+=`
<div class="item">
<div>â‚¹ ${h.amount}</div>
<div>${h.status}</div>
</div>
`;
});
}


/* GRAPH */

new Chart(document.getElementById("chart"),{
type:"line",
data:{
labels:my.map((_,i)=>"Tx "+(i+1)),
datasets:[{
label:"Earnings",
data:my.map(t=>t.amount),
borderWidth:2,
tension:.3
}]
},
options:{
responsive:true,
plugins:{legend:{display:false}}
}
});

}

loadWallet();


/* WITHDRAW */

async function withdraw(){

let amount=Number(document.getElementById("amount").value);
let upi=document.getElementById("upi").value;

if(!amount||!upi){
alert("Fill Details");
return;
}

if(amount<=0){
alert("Invalid Amount");
return;
}

if(balance<amount){
alert("Low Balance");
return;
}


let wallets=await getDB("wallets")||{};
let tx=await getDB("transactions")||[];
let withdraws=await getDB("withdraws")||[];

wallets[user.email]-=amount;

tx.push({
user:user.email,
amount:amount,
status:"Withdraw Pending",
time:new Date().toLocaleString()
});

withdraws.push({
user:user.email,
amount:amount,
upi:upi,
status:"Pending",
time:new Date().toLocaleString()
});

await saveDB("wallets",wallets);
await saveDB("transactions",tx);
await saveDB("withdraws",withdraws);


/* UPI OPEN */

window.location.href=
"upi://pay?pa="+upi+
"&pn=CreatorHub&am="+amount+
"&cu=INR";

alert("Withdraw Request Sent âœ…");

location.reload();

}

</script>

</body>
</html>
