<!DOCTYPE html>
<html lang="en">
<head>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">

<title>CreatorHub Wallet</title>

<style>

body{
margin:0;
font-family:Arial;
background:#020617;
color:white;
}

.topbar{
display:flex;
align-items:center;
padding:14px;
box-shadow:0 5px 20px black;
}

.back{
font-size:22px;
cursor:pointer;
width:40px;
}

.pageTitle{
flex:1;
text-align:center;
font-weight:bold;
color:#22c55e;
}

.container{
padding:18px;
}

.card{
background:#111827;
padding:18px;
border-radius:16px;
margin-bottom:18px;
}

.balance{
font-size:34px;
font-weight:bold;
color:#22c55e;
margin-top:10px;
}

input{
width:100%;
padding:14px;
margin-top:12px;
border:none;
border-radius:10px;
background:#020617;
color:white;
}

button{
width:100%;
padding:14px;
margin-top:15px;
border:none;
background:linear-gradient(90deg,#22c55e,#4ade80);
border-radius:12px;
font-weight:bold;
color:white;
cursor:pointer;
}

.item{
background:#020617;
padding:12px;
border-radius:10px;
margin-top:8px;
display:flex;
justify-content:space-between;
}

</style>

</head>

<body>

<div class="topbar">

<div class="back" onclick="history.back()">‚¨Ö</div>

<div class="pageTitle">

üí∞ Creator Wallet

</div>

</div>

<div class="container">

<div class="card">

<h3>Available Balance</h3>

‚Çπ <span id="balance" class="balance">0</span>

</div>


<div class="card">

<h3>Withdraw Money (20% Platform Fee)</h3>

<input id="upi" placeholder="Enter UPI ID">

<input id="amount" type="number" placeholder="Withdraw Amount ‚Çπ">

<button onclick="withdraw()">

Withdraw Request üöÄ

</button>

</div>


<div class="card">

<h3>üìú Earnings History</h3>

<div id="history">

Loading...

</div>

</div>

</div>


<script>

/* GOOGLE DRIVE BACKEND */

const API="https://script.google.com/macros/s/AKfycbzgKPuIAmuZWOfilOj8gM9qJcZesz3ECPIhpCvBmupKFY2t76_ObVWyylnoTa4ecyda/exec";

/* ADMIN WHATSAPP */

const ADMIN_NUMBER="918543936339";


let user=JSON.parse(localStorage.getItem("user"));

if(!user){

alert("Login First");

location.href="login.html";

}


/* DATABASE */

async function getDB(db){

try{

let r=await fetch(API+"?db="+db+"&t="+Date.now());

return await r.json();

}catch{

return [];

}

}

async function saveDB(db,data){

await fetch(API,{

method:"POST",

headers:{

"Content-Type":"application/json"

},

body:JSON.stringify({db,data})

});

}

let balance=0;


/* LOAD WALLET */

async function loadWallet(){

let wallets=await getDB("wallet")||[];

let my=wallets.find(w=>w.email===user.email);

balance=my?my.balance:0;

document.getElementById("balance").innerText=balance;


/* HISTORY */

let orders=await getDB("orders")||[];

let myOrders=orders.filter(o=>o.seller===user.email);

let box=document.getElementById("history");

if(!myOrders.length){

box.innerHTML="No Earnings Yet";

return;

}

box.innerHTML="";

myOrders.reverse().forEach(o=>{

let earn=Math.floor(o.amount*0.8);

box.innerHTML+=`

<div class="item">

<div>‚Çπ ${earn}</div>

<div>Sale</div>

</div>

`;

});

}

loadWallet();



/* FINAL WITHDRAW */

async function withdraw(){

let amount=Number(document.getElementById("amount").value);

let upi=document.getElementById("upi").value.trim();

if(!amount || !upi){

alert("Fill Details");

return;

}

if(amount<=0){

alert("Invalid Amount");

return;

}

if(balance<amount){

alert("Low Balance");

return;

}


/* CALCULATE SHARE */

let sendAmount=Math.floor(amount*0.8);

let adminCommission=amount-sendAmount;


/* LOAD DB */

let wallets=await getDB("wallet")||[];

let withdraws=await getDB("withdraw")||[];


/* FIND USER */

let index=wallets.findIndex(w=>w.email===user.email);

if(index===-1){

alert("Wallet Missing");

return;

}


/* üî• ZERO BALANCE AFTER WITHDRAW */

wallets[index].balance=0;


/* SAVE WITHDRAW */

withdraws.push({

email:user.email,

requestAmount:amount,

sendAmount:sendAmount,

adminCommission:adminCommission,

upi:upi,

status:"Pending (24Hr Processing)",

message:"Payment may take upto 24 hours",

date:new Date().toLocaleString()

});


await saveDB("wallet",wallets);

await saveDB("withdraw",withdraws);


/* REVIEW UNLOCK */

localStorage.setItem("reviewUnlock","true");


/* WHATSAPP ADMIN ALERT */

let msg=encodeURIComponent(

"üî• CreatorHub Withdraw Request\n\n"+

"User : "+user.email+"\n"+

"UPI : "+upi+"\n\n"+

"Requested ‚Çπ"+amount+"\n"+

"Send ‚Çπ"+sendAmount+"\n"+

"Admin ‚Çπ"+adminCommission

);

window.open(

"https://wa.me/"+ADMIN_NUMBER+"?text="+msg,

"_blank"

);


/* USER MESSAGE */

alert(

"‚úÖ Withdraw Request Sent\n\n"+

"‚è≥ Processing Started.\n"+

"üí≥ Money will arrive within 24 hours.\n"+

"‚ö° Sometimes earlier.\n\n"+

"‚≠ê Review Option Unlocked."

);


location.reload();

}

</script>

</body>

</html>
