<!DOCTYPE html>
<html lang="en">
<head>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">

<title>My Library - CreatorHub</title>

<style>

:root{
--bg:#ffffff;
--text:#111827;
--card:#f3f4f6;
--accent:#22c55e;
}

@media(prefers-color-scheme:dark){

:root{
--bg:#020617;
--text:#ffffff;
--card:#111827;
}

}

body{
margin:0;
font-family:Arial;
background:var(--bg);
color:var(--text);
}

/* HEADER */

.topbar{

display:flex;
align-items:center;

padding:14px;

background:var(--bg);

box-shadow:0 5px 20px rgba(0,0,0,.4);

position:sticky;
top:0;

z-index:999;

}

.back{

font-size:24px;
cursor:pointer;

width:40px;

}

.title{

flex:1;

text-align:center;

font-size:18px;

font-weight:bold;

color:var(--accent);

}

.dashboard{

background:var(--accent);

padding:8px 14px;

border-radius:20px;

font-size:13px;

color:white;

text-decoration:none;

}

/* GRID */

.container{
padding:18px;
}

.grid{

display:grid;

grid-template-columns:

repeat(auto-fit,minmax(230px,1fr));

gap:18px;

}

.card{

background:var(--card);

border-radius:14px;

padding:14px;

box-shadow:0 10px 25px rgba(0,0,0,.3);

}

.card img{

width:100%;

height:210px;

object-fit:cover;

border-radius:12px;

}

.bookTitle{

font-size:17px;

margin-top:10px;

font-weight:bold;

}

.price{

color:var(--accent);

margin-top:6px;

}

/* BUTTONS */

.read{

background:

linear-gradient(90deg,#22c55e,#4ade80);

border:none;

width:100%;

padding:12px;

margin-top:12px;

border-radius:10px;

color:white;

font-weight:bold;

cursor:pointer;

}

.download{

background:#2563eb;

border:none;

width:100%;

padding:12px;

margin-top:8px;

border-radius:10px;

color:white;

font-weight:bold;

cursor:pointer;

}

.empty{

text-align:center;

opacity:.7;

margin-top:50px;

font-size:18px;

}

</style>

</head>

<body>


<!-- HEADER -->

<div class="topbar">

<div class="back"

onclick="goBack()">

‚¨Ö

</div>

<div class="title">

üìö My Library

</div>

<a class="dashboard"

href="dashboard.html">

Dashboard

</a>

</div>



<div class="container">

<div id="library"

class="grid">

Loading Library...

</div>

</div>



<script>

/* BACK SAFE */

function goBack(){

if(document.referrer){

history.back();

}else{

location.href="dashboard.html";

}

}


/* FINAL API */

const API=

"https://script.google.com/macros/s/AKfycbzgKPuIAmuZWOfilOj8gM9qJcZesz3ECPIhpCvBmupKFY2t76_ObVWyylnoTa4ecyda/exec";


let user=

JSON.parse(localStorage.getItem("user"));


if(!user){

alert("Login First");

location.href="login.html";

}


/* DRIVE IMAGE FIX */

function driveImage(link){

if(!link)

return "https://picsum.photos/400";

try{

let id="";

if(link.includes("id=")){

id=link.split("id=")[1].split("&")[0];

}

if(id){

return "https://drive.google.com/thumbnail?id="+id+"&sz=w1000";

}

}catch{}

return link;

}


/* DRIVE PDF OPEN */

function drivePDF(link){

if(!link)return "#";

try{

let id="";

if(link.includes("id=")){

id=link.split("id=")[1].split("&")[0];

}

if(id){

return

"https://drive.google.com/file/d/"+id+"/preview";

}

}catch{}

return link;

}


/* DRIVE DOWNLOAD */

function driveDownload(link){

if(!link)return "#";

try{

let id="";

if(link.includes("id=")){

id=link.split("id=")[1].split("&")[0];

}

if(id){

return

"https://drive.google.com/uc?export=download&id="+id;

}

}catch{}

return link;

}


/* DB */

async function getDB(db){

try{

let r=

await fetch(

API+"?db="+db+"&t="+Date.now()

);

return await r.json();

}catch{

return [];

}

}


/* LOAD LIBRARY */

async function loadLibrary(){

try{

let orders=

await getDB("orders")||[];

let products=

await getDB("products")||[];

let box=

document.getElementById("library");


let myOrders=

orders.filter(

o=>o.buyer===user.email

);


if(!myOrders.length){

box.innerHTML=

"<div class='empty'>üòÑ No Purchased Ebook Yet</div>";

return;

}


box.innerHTML="";


myOrders.reverse()

.forEach(order=>{


let product=

products.find(

p=>String(p.id)===String(order.product)

);


if(!product)return;


let image=

driveImage(product.image);

let pdfView=

drivePDF(product.pdf);

let pdfDownload=

driveDownload(product.pdf);


box.innerHTML+=`

<div class="card">

<img src="${image}"

onerror="this.src='https://picsum.photos/400'">

<div class="bookTitle">

${product.title}

</div>

<div class="price">

‚Çπ ${product.price}

</div>

<button class="read"

onclick="window.open('${pdfView}','_blank')">

Read Ebook üìñ

</button>

<button class="download"

onclick="window.open('${pdfDownload}','_blank')">

Download PDF ‚¨á

</button>

</div>

`;

});


}catch(e){

console.log(e);

library.innerHTML=

"‚ùå Library Not Loading";

}

}

loadLibrary();

</script>

</body>

</html>
