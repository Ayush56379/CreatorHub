<!DOCTYPE html>
<html>

<head>

<meta name="viewport"
content="width=device-width,initial-scale=1">

<title>My Profile</title>

<style>

body{
margin:0;
font-family:Arial;
background:#020617;
color:white;
}

.topbar{
display:flex;
align-items:center;
padding:14px;
background:#020617;
box-shadow:0 5px 20px black;
}

.back{
font-size:22px;
cursor:pointer;
width:40px;
}

.title{
flex:1;
text-align:center;
color:#22c55e;
font-weight:bold;
}

.container{
max-width:500px;
margin:auto;
padding:20px;
}

.card{
background:#111827;
padding:25px;
border-radius:15px;
text-align:center;
}

.profileImg{
width:120px;
height:120px;
border-radius:50%;
object-fit:cover;
border:3px solid #22c55e;
margin-bottom:15px;
}

input{
width:100%;
padding:14px;
margin-top:12px;
border:none;
border-radius:10px;
background:#020617;
color:white;
}

button{

width:100%;
padding:14px;
margin-top:15px;
border:none;
border-radius:12px;

background:
linear-gradient(90deg,#22c55e,#4ade80);

color:white;
font-weight:bold;
cursor:pointer;

}

</style>

</head>

<body>

<div class="topbar">

<div class="back"

onclick="location.href='dashboard.html'">

⬅

</div>

<div class="title">

My Profile

</div>

</div>



<div class="container">

<div class="card">

<img id="profileImg"

class="profileImg">

<input id="name"

placeholder="Your Name">


<button onclick="saveProfile()">

Save Profile

</button>


<button onclick="uploadClick()">

Change Profile Picture

</button>


<input type="file"

id="upload"

accept="image/*"

style="display:none">


</div>

</div>



<script>

const API=

"https://script.google.com/macros/s/AKfycbw7xwjcEGIdj3xS8q7qhRNCSbch2uVsXFGFJYWgMNU4UPA-2BSfhq79PHsQ_oCEeYTm/exec";



let user=

JSON.parse(localStorage.getItem("user"));



if(!user){

location.href="login.html";

}



/* IMAGE LOAD */

document.getElementById("profileImg").src=

localStorage.getItem(

"profile_"+user.email

)

||

"https://cdn-icons-png.flaticon.com/512/149/149071.png";



document.getElementById("name").value=

user.name||"";



function uploadClick(){

document

.getElementById("upload")

.click();

}



/* DATABASE */

async function getDB(db){

let res=

await fetch(API+

"?db="+db+

"&t="+Date.now());

let data=

await res.json();

return Array.isArray(data)?

data:[];

}



async function saveDB(db,data){

await fetch(API,{

method:"POST",

headers:{

"Content-Type":

"application/json"

},

body:

JSON.stringify({

db:db,

data:data

})

});

}



/* SAVE PROFILE */

async function saveProfile(){

let newName=

document

.getElementById("name")

.value.trim();


if(!newName){

alert("Enter Name");

return;

}


/* UPDATE LOCAL */

user.name=newName;

localStorage.setItem(

"user",

JSON.stringify(user)

);


/* DRIVE SAVE */

let users=

await getDB("users");


let index=

users.findIndex(

u=>u.email===user.email

);


if(index!==-1){

users[index].name=newName;

}else{

users.push({

email:user.email,

name:newName,

seller:false,

banned:false,

created:new Date()

.toLocaleString()

});

}


await saveDB(

"users",

users

);

alert("Profile Saved ✅");

}



/* IMAGE UPLOAD */

document

.getElementById("upload")

.addEventListener(

"change",

async function(e){

let file=

e.target.files[0];

if(!file)return;


/* SIZE LIMIT */

if(file.size>

2*1024*1024){

alert("Max 2MB");

return;

}


let reader=

new FileReader();


reader.onload=

async function(){


let image=

reader.result;


/* LOCAL SAVE */

localStorage.setItem(

"profile_"+user.email,

image

);

document

.getElementById(

"profileImg"

)

.src=image;


/* DRIVE SAVE */

let profiles=

await getDB(

"profiles"

);


let index=

profiles.findIndex(

p=>p.email===user.email

);


if(index===-1){

profiles.push({

email:user.email,

image:image

});

}

else{

profiles[index]

.image=image;

}


await saveDB(

"profiles",

profiles

);


alert(

"Profile Image Saved ✅"

);

};


reader.readAsDataURL(

file

);

});

</script>

</body>

</html>
