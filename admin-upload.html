<!DOCTYPE html>
<html lang="en">

<head>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">

<title>Admin Upload Ebook</title>

<style>

body{
margin:0;
font-family:Arial;
background:#020617;
color:white;
}

/* TOPBAR */

.topbar{

display:flex;
align-items:center;
padding:14px;
background:#020617;
box-shadow:0 5px 20px black;

}

.back{

font-size:22px;
cursor:pointer;
width:40px;

}

.title{

flex:1;
text-align:center;
color:#22c55e;
font-weight:bold;

}

/* CONTAINER */

.container{

padding:20px;

}

.card{

background:#111827;
padding:25px;
border-radius:15px;
max-width:520px;
margin:auto;
margin-bottom:20px;

}

input{

width:100%;
padding:14px;
margin-top:12px;
border:none;
border-radius:10px;
background:#020617;
color:white;

}

button{

width:100%;
padding:15px;
margin-top:15px;
border:none;
border-radius:10px;
background:#22c55e;
color:white;
font-weight:bold;
cursor:pointer;

}

</style>

</head>

<body>


<!-- HEADER -->

<div class="topbar">

<div class="back"
onclick="location.href='admin.html'">

â¬…

</div>

<div class="title">

ðŸ‘‘ Admin Upload Ebook

</div>

</div>



<div class="container">


<!-- ADMIN UPLOAD -->

<div class="card">

<h2>Upload Ebook (Auto Approved)</h2>

<input id="title"
placeholder="Ebook Title">

<input id="price"
type="number"
placeholder="Price">

<input id="image"
placeholder="Drive Cover Image Link">

<input id="pdf"
placeholder="Drive PDF Link">

<button onclick="uploadAdminBook()">

Upload + Auto Approve âœ…

</button>

</div>



<!-- PERMISSION -->

<div class="card">

<h2>ðŸ”“ Give Upload Permission</h2>

<input id="permEmail"
placeholder="User Email">

<button onclick="givePermission()">

Give Upload Permission âœ…

</button>

</div>

</div>



<script>

/* ADMIN */

const ADMIN="ayushprajpati6@gmail.com";

/* API */

const API=
"https://script.google.com/macros/s/AKfycbzgKPuIAmuZWOfilOj8gM9qJcZesz3ECPIhpCvBmupKFY2t76_ObVWyylnoTa4ecyda/exec";


let user=
JSON.parse(localStorage.getItem("user"));


/* ADMIN SECURITY */

if(!user || user.email!==ADMIN){

alert("Admin Only");

location.href="index.html";

}


/* DB */

async function getDB(db){

let r=
await fetch(API+"?db="+db+"&t="+Date.now());

let data=
await r.json();

return Array.isArray(data)?data:[];

}


async function saveDB(db,data){

await fetch(API,{

method:"POST",

headers:{

"Content-Type":"text/plain"

},

body:

JSON.stringify({

db:db,

data:data

})

});

}


/* ADMIN UPLOAD */

async function uploadAdminBook(){

let title=
document.getElementById("title").value.trim();

let price=
document.getElementById("price").value.trim();

let image=
document.getElementById("image").value.trim();

let pdf=
document.getElementById("pdf").value.trim();


if(!title||!price||!image||!pdf){

alert("Fill All Fields");

return;

}


let products=
await getDB("products");


products.push({

id:Date.now(),

title:title,

price:Number(price),

image:image,

pdf:pdf,

owner:"ADMIN",

status:"approved",

date:new Date().toLocaleString()

});


await saveDB("products",products);

alert("Ebook Uploaded + Approved âœ…");


location.reload();

}



/* GIVE PERMISSION */

async function givePermission(){

let email=

document.getElementById("permEmail")

.value.trim();

if(!email){

alert("Enter Email");

return;

}

let users=

await getDB("users");


let index=

users.findIndex(

u=>u.email===email

);


if(index===-1){

alert("User Not Found");

return;

}


/* SELLER ALSO TRUE */

users[index].seller=true;


/* UPLOAD PERMISSION */

users[index].uploadPermission=true;


await saveDB(

"users",

users

);

alert(

"Upload Permission Granted âœ…"

);

document.getElementById("permEmail").value="";

}

</script>

</body>

</html>
