<!DOCTYPE html>
<html lang="en">
<head>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">

<title>CreatorHub SUPER ADMIN</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>

body{
margin:0;
font-family:Arial;
background:#020617;
color:white;
}

.topbar{
display:flex;
align-items:center;
padding:14px;
background:#020617;
box-shadow:0 5px 20px black;
}

.back{
font-size:22px;
cursor:pointer;
width:40px;
}

.title{
flex:1;
text-align:center;
color:#22c55e;
font-weight:bold;
}

.container{
max-width:1100px;
margin:auto;
padding:20px;
}

.card{
background:#111827;
padding:20px;
border-radius:15px;
margin-bottom:20px;
}

.row{
background:#020617;
padding:12px;
border-radius:10px;
margin-top:10px;
}

button{
border:none;
padding:8px 12px;
border-radius:8px;
cursor:pointer;
color:white;
margin:4px;
}

.edit{background:orange;}
.delete{background:red;}
.approve{background:#22c55e;}
.reject{background:#ef4444;}
.ban{background:red;}

.big{
font-size:28px;
color:#22c55e;
}

input{
width:100%;
padding:12px;
margin-top:10px;
border:none;
border-radius:8px;
background:#020617;
color:white;
}

#editBox{
display:none;
position:fixed;
top:0;
left:0;
width:100%;
height:100%;
background:rgba(0,0,0,.8);
overflow:auto;
z-index:99999;
}

.editContent{
background:#111827;
max-width:520px;
margin:40px auto;
padding:20px;
border-radius:12px;
}

</style>

</head>

<body>

<div class="topbar">

<div class="back"
onclick="history.back()">
‚¨Ö
</div>

<div class="title">
üî• CreatorHub SUPER ADMIN
</div>

</div>

<div class="container">

<div class="card">

<h2>üí∞ Owner Profit</h2>

‚Çπ <span id="profit" class="big">0</span>

</div>

<div class="card">

<h2>üìä Earnings Analytics</h2>

<canvas id="chart"></canvas>

</div>

<div class="card">

<h2>üì¶ Product Control</h2>

<div id="products">

Loading...

</div>

</div>

<div class="card">

<h2>üë§ USER WALLET BALANCE</h2>

<div id="wallets">

Loading...

</div>

</div>

<div class="card">

<h2>üö´ Seller Control</h2>

<div id="sellers">

Loading...

</div>

</div>

<div class="card">

<h2>üè¶ Withdraw Requests</h2>

<div id="withdraws">

Loading...

</div>

</div>

</div>



<!-- EDIT -->

<div id="editBox">

<div class="editContent">

<h2>Edit Ebook</h2>

<input id="eTitle">

<input id="ePrice" type="number">

<input id="eSeller">

<button class="approve"
onclick="saveEdit()">

Save ‚úÖ

</button>

<button class="reject"
onclick="deleteEdit()">

Delete Ebook ‚ùå

</button>

<button onclick="closeEdit()">

Cancel

</button>

</div>

</div>

<script>

const ADMIN="ayushprajpati6@gmail.com";

const API="https://script.google.com/macros/s/AKfycbzgKPuIAmuZWOfilOj8gM9qJcZesz3ECPIhpCvBmupKFY2t76_ObVWyylnoTa4ecyda/exec";


let user=
JSON.parse(localStorage.getItem("user"));

if(!user || user.email!==ADMIN){

alert("Admin Only");

location.href="index.html";

}



/* DB */

async function getDB(db){

try{

let r=
await fetch(API+"?db="+db+"&t="+Date.now());

return await r.json();

}catch(e){

console.log(e);

return [];

}

}

async function saveDB(db,data){

await fetch(API,{

method:"POST",

headers:{
"Content-Type":"text/plain"
},

body:JSON.stringify({

db:db,

data:data

})

});

}



/* PRODUCTS */

let editID=null;

async function loadProducts(){

let products=
await getDB("products");

let box=
document.getElementById("products");

box.innerHTML="";

products.reverse()

.forEach(p=>{

let btn=`

<button class="edit"
onclick="openEdit(${p.id})">
Edit
</button>

<button class="delete"
onclick="deleteProduct(${p.id})">
Delete
</button>

`;

if(p.status!=="approved"){

btn+=`

<button class="approve"
onclick="approve(${p.id})">
Approve
</button>

<button class="reject"
onclick="reject(${p.id})">
Reject
</button>

`;

}

box.innerHTML+=`

<div class="row">

<b>${p.title}</b>

‚Çπ${p.price}

<br>

Seller :
${p.owner}

<br>

Status :
${p.status}

<br>

${btn}

</div>

`;

});

}



async function openEdit(id){

editID=id;

let products=
await getDB("products");

let p=
products.find(x=>Number(x.id)===Number(id));

if(!p){

alert("Product Not Found");

return;

}

eTitle.value=p.title;

ePrice.value=p.price;

eSeller.value=p.owner;

editBox.style.display="block";

}

function closeEdit(){

editBox.style.display="none";

}



async function saveEdit(){

let products=
await getDB("products");

products=
products.map(p=>{

if(Number(p.id)===Number(editID)){

p.title=eTitle.value;

p.price=Number(ePrice.value);

p.owner=eSeller.value;

}

return p;

});

await saveDB("products",products);

alert("Saved ‚úÖ");

closeEdit();

loadProducts();

}



async function deleteEdit(){

await deleteProduct(editID);

closeEdit();

}



async function deleteProduct(id){

let products=
await getDB("products");

products=
products.filter(

p=>Number(p.id)!==Number(id)

);

await saveDB("products",products);

loadProducts();

}



async function approve(id){

let products=
await getDB("products");

products=
products.map(p=>{

if(Number(p.id)===Number(id)){

p.status="approved";

}

return p;

});

await saveDB("products",products);

alert("Approved ‚úÖ");

loadProducts();

}



async function reject(id){

await deleteProduct(id);

}



/* WALLET */

async function loadWallets(){

let wallets=
await getDB("wallet");

let box=
document.getElementById("wallets");

box.innerHTML="";

wallets.forEach(w=>{

box.innerHTML+=`

<div class="row">

${w.email}

<br>

Balance ‚Çπ${w.balance||0}

</div>

`;

});

}



/* SELLER */

async function loadSellers(){

let users=
await getDB("users");

let box=
document.getElementById("sellers");

box.innerHTML="";

users.forEach(u=>{

box.innerHTML+=`

<div class="row">

${u.email}

<button class="ban"

onclick="ban('${u.email}')">

Ban

</button>

</div>

`;

});

}



async function ban(email){

let users=
await getDB("users");

users=
users.map(u=>{

if(u.email===email){

u.banned=true;

}

return u;

});

await saveDB("users",users);

alert("User Banned");

loadSellers();

}



/* WITHDRAW */

async function loadWithdraw(){

let withdraw=
await getDB("withdraw");

let box=
document.getElementById("withdraws");

box.innerHTML="";

withdraw.reverse()

.forEach(w=>{

if(w.status==="Approved")

return;

box.innerHTML+=`

<div class="row">

${w.email}

‚Çπ${w.requestAmount}

<button class="approve"

onclick="approveWithdraw('${w.date}')">

Approve

</button>

</div>

`;

});

}



async function approveWithdraw(date){

let withdraw=
await getDB("withdraw");

withdraw=
withdraw.map(w=>{

if(w.date==date){

w.status="Approved";

}

return w;

});

await saveDB("withdraw",withdraw);

alert("Withdraw Approved");

loadWithdraw();

}



/* PROFIT */

async function profit(){

let orders=
await getDB("orders");

let total=0;

orders.forEach(o=>{

total+=o.amount*.20;

});

document.getElementById("profit")

.innerText=Math.floor(total);



new Chart(

document.getElementById("chart"),

{

type:"line",

data:{

labels:

orders.map((_,i)=>

"Order "+(i+1)),

datasets:[{

label:"Profit",

data:

orders.map(o=>o.amount*.20),

borderColor:"#22c55e"

}]

}

});

}



/* LOAD */

loadProducts();

loadWallets();

loadSellers();

loadWithdraw();

profit();

</script>

</body>
</html>
