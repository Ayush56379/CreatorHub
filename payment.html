<!DOCTYPE html>
<html lang="en">

<head>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">

<title>Buy Ebook</title>

<style>

body{
margin:0;
font-family:Arial;
background:#020617;
color:white;
}

/* TOPBAR */

.topbar{

display:flex;
align-items:center;
padding:14px;

box-shadow:0 5px 20px black;

}

.back{

font-size:22px;
cursor:pointer;
width:40px;

}

.title{

flex:1;
text-align:center;
font-weight:bold;
color:#22c55e;

}

/* CARD */

.container{

padding:20px;

}

.card{

background:#111827;

padding:20px;

border-radius:16px;

max-width:520px;

margin:auto;

}

.card img{

width:100%;
height:220px;

object-fit:cover;

border-radius:12px;

}

button{

width:100%;

padding:15px;

margin-top:15px;

border:none;

border-radius:10px;

font-weight:bold;

cursor:pointer;

}

.pay{

background:orange;

}

.confirm{

background:

linear-gradient(90deg,#22c55e,#4ade80);

color:white;

}

</style>

</head>

<body>

<div class="topbar">

<div class="back"
onclick="history.back()">

â¬…

</div>

<div class="title">

CreatorHub

</div>

</div>


<div class="container">

<div class="card">

<h2>ðŸ’³ Buy Ebook</h2>

<img id="cover">

<h3 id="title"></h3>

<h2 id="price"></h2>


<button class="pay"

onclick="payNow()">

Pay Using UPI ðŸš€

</button>


<button class="confirm"

onclick="confirmPayment()">

I Have Paid âœ…

</button>


</div>

</div>


<script>

/* FINAL DRIVE BACKEND */

const API=

"https://script.google.com/macros/s/AKfycbzgKPuIAmuZWOfilOj8gM9qJcZesz3ECPIhpCvBmupKFY2t76_ObVWyylnoTa4ecyda/exec";


/* ADMIN RECEIVE UPI */

const ADMIN_UPI=

"ayushprajapati@okaxis"; // CHANGE ONLY IF NEEDED


function driveImage(link){

if(!link)return"https://picsum.photos/500";

try{

let id="";

if(link.includes("id=")){

id=link.split("id=")[1].split("&")[0];

}

if(id){

return "https://drive.google.com/thumbnail?id="+id+"&sz=w1000";

}

}catch{}

return link;

}


let buyId=

localStorage.getItem("buyProduct");


let user=

JSON.parse(

localStorage.getItem("user")

)||{email:"guest"};


async function getDB(db){

let r=

await fetch(

API+"?db="+db+"&t="+Date.now()

);

return await r.json();

}


async function saveDB(db,data){

await fetch(API,{

method:"POST",

headers:{

"Content-Type":

"application/json"

},

body:JSON.stringify({

db:db,

data:data

})

});

}


/* LOAD PRODUCT */

let product=null;

async function load(){

let products=

await getDB("products");


product=

products.find(

p=>p.id==buyId

);


if(!product){

alert("Product Missing");

history.back();

}


cover.src=

driveImage(product.image);

title.innerText=

product.title;

price.innerText=

"â‚¹ "+product.price;

}

load();



/* PAY OPEN */

function payNow(){

let upi=

`upi://pay?pa=${ADMIN_UPI}

&pn=CreatorHub

&am=${product.price}

&cu=INR`;


window.location.href=

upi;

}


/* PAYMENT CONFIRM */

async function confirmPayment(){

if(!product)return;


if(

!confirm(

"Payment Done?"

)

)return;


try{


/* SAVE ORDER */

let orders=

await getDB("orders");

orders.push({

buyer:user.email,

product:product.id,

seller:product.owner,

amount:product.price,

date:new Date()

.toLocaleString()

});


await saveDB(

"orders",

orders

);


/* WALLET CREDIT */

let wallets=

await getDB("wallet");


let earning=

Math.floor(

product.price*0.8

);


let seller=

wallets.find(

w=>w.email===product.owner

);


if(seller){

seller.balance+=earning;

}else{

wallets.push({

email:

product.owner,

balance:earning

});

}


await saveDB(

"wallet",

wallets

);


alert(

"Payment Success âœ… Wallet Credited"

);


/* CLEAR BUY */

localStorage.removeItem(

"buyProduct"

);


location.href=

"dashboard.html";


}catch(e){

console.log(e);

alert("Error Saving");

}

}

</script>

</body>

</html>
