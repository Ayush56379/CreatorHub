<!DOCTYPE html>
<html>

<head>

<meta name="viewport"
content="width=device-width,initial-scale=1">

<title>Pay Ebook</title>

<style>

body{

margin:0;

font-family:Arial;

background:
linear-gradient(
180deg,#020617,#111827);

color:white;

text-align:center;

padding:20px;

}

.card{

background:#111827;

max-width:420px;

margin:auto;

padding:25px;

border-radius:18px;

box-shadow:
0 15px 40px rgba(0,0,0,.7);

}

button{

width:100%;

padding:15px;

margin-top:18px;

border:none;

border-radius:12px;

font-weight:bold;

cursor:pointer;

background:
linear-gradient(
90deg,#22c55e,#4ade80);

}

.loading{

display:none;

margin-top:15px;

}

</style>

</head>

<body>

<div class="card">

<h2>üí≥ Pay Ebook</h2>

<p>

Confirm Payment After UPI Transfer

</p>

<h3 id="title">

Loading...

</h3>

<h2>

‚Çπ <span id="price">

0

</span>

</h2>

<button id="payBtn"
onclick="confirmPayment()">

I Have Paid ‚úÖ

</button>

<div class="loading"
id="loading">

Processing Payment...

</div>

</div>


<script>


// ‚≠ê‚≠ê‚≠ê GOOGLE DRIVE API ‚≠ê‚≠ê‚≠ê

const API=

"https://script.google.com/macros/s/AKfycbw7xwjcEGIdj3xS8q7qhRNCSbch2uVsXFGFJYWgMNU4UPA-2BSfhq79PHsQ_oCEeYTm/exec";



// LOGIN CHECK

let user=

JSON.parse(

localStorage.getItem("user")

);

if(!user){

location.href="login.html";

}



// DRIVE GET

async function getDB(db){

const res=

await fetch(API+"?db="+db);

return await res.json();

}



// DRIVE SAVE

async function saveDB(db,data){

await fetch(API,{

method:"POST",

body:JSON.stringify({

db:db,

data:data

})

});

}



// LOAD PRODUCT

let productID=

localStorage.getItem(

"buyProduct"

);

let product=null;



async function loadProduct(){


let products=

await getDB("products");


product=

products.find(

p=>String(p.id)==productID

);


if(!product){

alert("Product Missing");

location.href="products.html";

return;

}


title.innerText=

product.title;

price.innerText=

product.price;

}

loadProduct();




// ‚≠ê‚≠ê‚≠ê PAYMENT ‚≠ê‚≠ê‚≠ê

async function confirmPayment(){


if(!product)return;


// BUTTON LOCK

payBtn.disabled=true;

loading.style.display="block";


// LOAD DATABASE

let orders=

await getDB("orders");

let wallets=

await getDB("wallets");

let tx=

await getDB("transactions");


// ‚≠ê DUPLICATE BUY STOP

let already=

orders.find(o=>

o.user==user.email

&&

String(o.id)==productID

);


if(already){

alert("Already Purchased");

location.href="orders.html";

return;

}



// SAVE ORDER

orders.push({

orderID:Date.now(),

productID:product.id,

user:user.email,

title:product.title,

price:product.price,

pdf:product.pdf,

image:product.image,

date:new Date().toLocaleString()

});




// ‚≠ê MONEY SPLIT ‚≠ê

let seller=

product.owner;

let admin=

"ayushprajpati6@gmail.com";


// SELLER 80%

let sellerAmount=

Number(product.price)*0.80;


// ADMIN 20%

let adminProfit=

Number(product.price)*0.20;



// SELLER WALLET

wallets[seller]=

(wallets[seller]||0)

+sellerAmount;


// ADMIN WALLET

wallets[admin]=

(wallets[admin]||0)

+adminProfit;




// SAVE TRANSACTIONS

tx.push({

user:seller,

amount:sellerAmount,

type:"Sale",

product:product.title,

date:new Date().toLocaleString()

});


tx.push({

user:admin,

amount:adminProfit,

type:"Commission",

product:product.title,

date:new Date().toLocaleString()

});




// SAVE DRIVE

await saveDB("orders",orders);

await saveDB("wallets",wallets);

await saveDB("transactions",tx);



alert(

"Payment Successful ‚úÖ Ebook Added"

);


// GO LIBRARY

location.href="orders.html";


}

</script>

</body>

</html>
