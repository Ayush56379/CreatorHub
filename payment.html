<!DOCTYPE html>
<html>

<head>

<meta name="viewport"
content="width=device-width,initial-scale=1">

<title>Pay Ebook - CreatorHub</title>

<style>

body{

margin:0;
font-family:Arial;

background:

linear-gradient(
180deg,#020617,#111827);

color:white;

padding:20px;

}

.card{

background:#1f2937;

padding:25px;

border-radius:18px;

max-width:520px;

margin:auto;

box-shadow:
0 15px 40px rgba(0,0,0,.7);

}

img{

width:100%;

border-radius:14px;

margin-bottom:15px;

}

button{

width:100%;

padding:16px;

margin-top:14px;

border:none;

background:

linear-gradient(
90deg,#f59e0b,#f97316);

border-radius:12px;

font-weight:bold;

cursor:pointer;

}

.back{

background:#2563eb;

padding:10px 18px;

border-radius:10px;

display:inline-block;

margin-bottom:15px;

cursor:pointer;

}

</style>

</head>

<body>

<div class="back"

onclick="history.back()">

‚¨Ö Back

</div>


<div class="card">

<h2>

üí≥ Buy Ebook

</h2>


<div id="product">

Loading...

</div>


<button onclick="completePayment()">

I Have Paid ‚úÖ

</button>

</div>



<script>


// ‚≠ê GOOGLE DRIVE API

const API=

"https://script.google.com/macros/s/AKfycbw7xwjcEGIdj3xS8q7qhRNCSbch2uVsXFGFJYWgMNU4UPA-2BSfhq79PHsQ_oCEeYTm/exec";



// ‚≠ê ADMIN EMAIL

const ADMIN=

"ayushprajpati6@gmail.com";



// LOGIN CHECK

let user=

JSON.parse(

localStorage.getItem("user")

);


if(!user){

alert("Login First");

location.href="login.html";

}



// GET DB

async function getDB(db){

const res=

await fetch(

API+"?db="+db

);

return await res.json();

}



// SAVE DB

async function saveDB(db,data){

await fetch(

API,{

method:"POST",

body:JSON.stringify({

db:db,

data:data

})

});

}



// PRODUCT LOAD

let buyID=

localStorage.getItem(

"buyProduct"

);


let product;



async function loadProduct(){


let products=

await getDB("products");


product=

products.find(

p=>String(p.id)===buyID

);


if(!product){

document.getElementById(

"product"

).innerHTML=

"Product Not Found";

return;

}


document.getElementById(

"product"

).innerHTML=`

<img src="${product.image}">

<h3>${product.title}</h3>

Price ‚Çπ${product.price}

`;

}


loadProduct();




// PAYMENT COMPLETE ‚≠ê‚≠ê‚≠ê

async function completePayment(){


if(!product)return;


alert("Processing Payment...");


let wallets=

await getDB("wallets");

let orders=

await getDB("orders");

let tx=

await getDB("transactions");




// SELLER MONEY

let sellerAmount=

product.price * 0.80;


// ADMIN PROFIT

let adminProfit=

product.price * 0.20;



// SELLER ADD

wallets[product.owner]=

(wallets[product.owner]||0)

+ sellerAmount;



// ADMIN ADD

wallets[ADMIN]=

(wallets[ADMIN]||0)

+ adminProfit;




// ORDER SAVE

orders.push({

id:Date.now(),

user:user.email,

title:product.title,

price:product.price,

pdf:product.pdf,

date:new Date()

.toLocaleString()

});




// TRANSACTION SAVE

tx.push({

user:user.email,

product:product.title,

amount:product.price,

status:"Paid",

time:new Date()

.toLocaleString()

});




// SAVE DRIVE

await saveDB(

"wallets",

wallets

);

await saveDB(

"orders",

orders

);

await saveDB(

"transactions",

tx

);



// OPEN PDF

window.open(

product.pdf,

"_blank"

);



alert(

"Payment Successful ‚úÖ"

);


location.href=

"orders.html";


}


</script>

</body>

</html>
