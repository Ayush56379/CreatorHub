<!DOCTYPE html>
<html>

<head>

<meta name="viewport"
content="width=device-width,initial-scale=1">

<title>Pay Ebook</title>

<style>

body{

margin:0;
font-family:Arial;

background:

linear-gradient(
180deg,
#020617,
#111827);

color:white;

text-align:center;

padding:20px;

}

.card{

background:#111827;

max-width:420px;

margin:auto;

padding:25px;

border-radius:18px;

box-shadow:

0 15px 40px rgba(0,0,0,.7);

}

button{

width:100%;

padding:15px;

margin-top:18px;

border:none;

border-radius:12px;

font-weight:bold;

cursor:pointer;

background:

linear-gradient(
90deg,#22c55e,#4ade80);

}

</style>

</head>

<body>

<div class="card">

<h2>

üí≥ Pay Ebook

</h2>

<p>

Confirm Payment After UPI Transfer

</p>

<h3 id="title">

Loading...

</h3>

<h2>

‚Çπ <span id="price">

0

</span>

</h2>

<button onclick="confirmPayment()">

I Have Paid ‚úÖ

</button>

</div>


<script>


// ‚≠ê GOOGLE DRIVE API

const API=

"https://script.google.com/macros/s/AKfycbw7xwjcEGIdj3xS8q7qhRNCSbch2uVsXFGFJYWgMNU4UPA-2BSfhq79PHsQ_oCEeYTm/exec";



// LOGIN CHECK

let user=

JSON.parse(

localStorage.getItem("user")

);


if(!user){

alert("Login First");

location.href="login.html";

}



// GET DB

async function getDB(db){

const res=

await fetch(API+"?db="+db);

return await res.json();

}



// SAVE DB

async function saveDB(db,data){

await fetch(API,{

method:"POST",

body:JSON.stringify({

db:db,

data:data

})

});

}



// LOAD PRODUCT ‚≠ê‚≠ê‚≠ê

let productID=

localStorage.getItem(

"buyProduct"

);


let product=null;



async function loadProduct(){


let products=

await getDB("products");


product=

products.find(

p=>String(p.id)==productID

);


if(!product){

alert("Product Not Found");

location.href="products.html";

return;

}


document.getElementById(

"title"

).innerText=

product.title;


document.getElementById(

"price"

).innerText=

product.price;

}

loadProduct();




// PAYMENT SUCCESS ‚≠ê‚≠ê‚≠ê

async function confirmPayment(){


if(!product)return;


// LOAD DATABASE

let orders=

await getDB("orders");

let wallets=

await getDB("wallets");

let tx=

await getDB("transactions");



// SAVE ORDER

orders.push({

id:Date.now(),

user:user.email,

title:product.title,

price:product.price,

pdf:product.pdf,

image:product.image,

date:new Date().toLocaleString()

});



// ‚≠ê SELLER MONEY

let seller=

product.owner;


// 80%

let sellerAmount=

product.price * .80;


// ADMIN EMAIL ‚≠ê‚≠ê‚≠ê

let admin=

"ayushprajpati6@gmail.com";


// 20%

let adminProfit=

product.price * .20;


// SELLER WALLET

wallets[seller]=

(wallets[seller]||0)

+ sellerAmount;


// ADMIN WALLET

wallets[admin]=

(wallets[admin]||0)

+ adminProfit;




// SAVE TRANSACTIONS

tx.push({

user:seller,

amount:sellerAmount,

type:"Sale",

product:product.title,

date:new Date().toLocaleString()

});


tx.push({

user:admin,

amount:adminProfit,

type:"Commission",

product:product.title,

date:new Date().toLocaleString()

});




// SAVE DRIVE

await saveDB(

"orders",

orders

);

await saveDB(

"wallets",

wallets

);

await saveDB(

"transactions",

tx

);



alert(

"Payment Successful ‚úÖ Ebook Added"

);


// LIBRARY PAGE

location.href="orders.html";

}

</script>

</body>

</html>
