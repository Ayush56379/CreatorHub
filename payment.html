<!DOCTYPE html>
<html>

<head>

<meta name="viewport"
content="width=device-width,initial-scale=1">

<title>Pay Ebook - CreatorHub</title>

<style>

/* DEVICE AUTO THEME */

:root{
--bg:#ffffff;
--text:#111827;
--card:#f3f4f6;
--accent:#22c55e;
}

@media (prefers-color-scheme:dark){

:root{

--bg:#020617;
--text:#ffffff;
--card:#111827;

}

}

body{

margin:0;
font-family:Arial;
background:var(--bg);
color:var(--text);

}

/* HEADER */

.topbar{

display:flex;
align-items:center;
padding:14px;
background:var(--bg);
box-shadow:0 4px 15px rgba(0,0,0,.3);
position:sticky;
top:0;
z-index:99;

}

/* BACK BUTTON */

.back{

font-size:22px;
cursor:pointer;
width:40px;

}

/* TITLE */

.title{

flex:1;
text-align:center;
font-weight:bold;
color:var(--accent);
font-size:18px;

}

</style>


<style>

body{

margin:0;
font-family:Arial;

background:
linear-gradient(
180deg,#020617,#111827);

color:white;

padding:20px;

}

.card{

background:#1f2937;

padding:25px;

border-radius:18px;

max-width:520px;

margin:auto;

box-shadow:
0 15px 40px rgba(0,0,0,.7);

}

img{

width:100%;

border-radius:14px;

margin-bottom:15px;

}

button{

width:100%;

padding:16px;

margin-top:14px;

border:none;

background:
linear-gradient(
90deg,#22c55e,#4ade80);

border-radius:12px;

font-weight:bold;

cursor:pointer;

}

.back{

background:#2563eb;

padding:10px 18px;

border-radius:10px;

display:inline-block;

margin-bottom:15px;

cursor:pointer;

}

</style>

</head>

<body>

<div class="topbar">

<div class="back"
onclick="goBack()">

‚¨Ö

</div>

<div class="title">

CreatorHub

</div>

</div>


<div class="back"
onclick="history.back()">

‚¨Ö Back

</div>


<div class="card">

<h2>

üí≥ Buy Ebook

</h2>

<div id="product">

Loading...

</div>

<button onclick="completePayment()">

I Have Paid ‚úÖ

</button>

</div>



<script>

// BACK FUNCTION

function goBack(){

history.back();

}


// ‚≠ê‚≠ê‚≠ê API

const API=

"https://script.google.com/macros/s/AKfycbw7xwjcEGIdj3xS8q7qhRNCSbch2uVsXFGFJYWgMNU4UPA-2BSfhq79PHsQ_oCEeYTm/exec";


// ‚≠ê ADMIN EMAIL

const ADMIN=

"ayushprajpati6@gmail.com";


// LOGIN CHECK

let user=

JSON.parse(

localStorage.getItem("user")

);

if(!user){

alert("Login First");

location.href="login.html";

}


// DRIVE GET

async function getDB(db){

const res=

await fetch(API+"?db="+db);

return await res.json();

}


// DRIVE SAVE

async function saveDB(db,data){

await fetch(API,{

method:"POST",

body:JSON.stringify({

db:db,

data:data

})

});

}


// LOAD PRODUCT

let buyID=

localStorage.getItem("buyProduct");

let product;


async function loadProduct(){

let products=

await getDB("products");

product=

products.find(

p=>String(p.id)===buyID

);


// BLOCK ADMIN APPROVAL

if(!product ||

product.status==="pending"){

document.getElementById(

"product"

).innerHTML=

"‚ùå Product Not Available";

return;

}


document.getElementById(

"product"

).innerHTML=`

<img src="${product.image}">

<h3>${product.title}</h3>

<h3>‚Çπ ${product.price}</h3>

`;

}

loadProduct();



// FINAL PAYMENT ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê

async function completePayment(){

if(!product)return;

alert("Processing Payment...");

let wallets=

await getDB("wallets");

let orders=

await getDB("orders");

let tx=

await getDB("transactions");


// ‚≠ê DUPLICATE BUY BLOCK

let already=

orders.find(o=>

o.user===user.email &&

o.productID===product.id

);

if(already){

alert("Already Purchased");

location.href="orders.html";

return;

}


// SELLER 80%

let sellerAmount=

product.price * 0.80;


// ADMIN 20%

let adminProfit=

product.price * 0.20;


// SELLER WALLET

wallets[product.owner]=

(wallets[product.owner]||0)

+ sellerAmount;


// ADMIN WALLET

wallets[ADMIN]=

(wallets[ADMIN]||0)

+ adminProfit;


// SAVE ORDER

orders.push({

id:Date.now(),

productID:product.id,

user:user.email,

title:product.title,

price:product.price,

pdf:product.pdf,

owner:product.owner,

date:new Date()

.toLocaleString()

});


// BUYER TX

tx.push({

user:user.email,

type:"buy",

product:product.title,

amount:product.price,

status:"Paid",

time:new Date()

.toLocaleString()

});


// SELLER TX

tx.push({

user:product.owner,

type:"sale",

product:product.title,

amount:sellerAmount,

status:"Earned",

time:new Date()

.toLocaleString()

});


// ADMIN TX

tx.push({

user:ADMIN,

type:"profit",

product:product.title,

amount:adminProfit,

status:"Owner Profit",

time:new Date()

.toLocaleString()

});


// SAVE DRIVE ‚≠ê‚≠ê‚≠ê

await saveDB(

"wallets",

wallets

);

await saveDB(

"orders",

orders

);

await saveDB(

"transactions",

tx

);


// OPEN PDF

window.open(

product.pdf,

"_blank"

);

alert(

"Payment Successful ‚úÖ"

);

location.href=

"orders.html";

}

</script>

</body>

</html>
