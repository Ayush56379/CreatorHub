<!DOCTYPE html>
<html>

<head>

<meta name="viewport"
content="width=device-width,initial-scale=1">

<title>Reviews</title>

<style>

body{
margin:0;
font-family:Arial;
background:#111;
color:white;
}

/* HEADER */

.header{
display:flex;
align-items:center;
justify-content:space-between;
background:#000;
padding:12px;
}

.backBtn{
background:#2563eb;
border:none;
color:white;
padding:8px 12px;
border-radius:8px;
cursor:pointer;
font-size:18px;
}

.title{
font-size:18px;
}

.dashBtn{
background:#f59e0b;
padding:8px 14px;
border-radius:8px;
color:white;
text-decoration:none;
}

/* CARD */

.container{
padding:20px;
}

.card{
background:#1f2937;
padding:20px;
border-radius:12px;
}

textarea{
width:100%;
height:120px;
border-radius:10px;
border:none;
margin-top:10px;
padding:10px;
}

.submitBtn{
width:100%;
padding:14px;
margin-top:10px;
border:none;
background:orange;
border-radius:10px;
cursor:pointer;
font-size:16px;
}

.star{
font-size:26px;
cursor:pointer;
}

.review{
background:#111;
padding:10px;
border-radius:8px;
margin-top:10px;
}

</style>

</head>

<body>


<div class="header">

<button class="backBtn"
onclick="history.back()">

⬅

</button>

<div class="title">

⭐ Reviews

</div>

<a href="./dashboard.html"
class="dashBtn">

Dashboard

</a>

</div>



<div class="container">

<div class="card">

<h2>

Leave Review ⭐

</h2>


<div id="stars">

<span class="star"
onclick="setStar(1)">⭐</span>

<span class="star"
onclick="setStar(2)">⭐</span>

<span class="star"
onclick="setStar(3)">⭐</span>

<span class="star"
onclick="setStar(4)">⭐</span>

<span class="star"
onclick="setStar(5)">⭐</span>

</div>


<textarea id="reviewText"
placeholder="Write Review">
</textarea>


<button class="submitBtn"
onclick="submitReview()">

Submit Review

</button>


<h3>

My Reviews

</h3>


<div id="reviewList">

Loading...

</div>

</div>

</div>



<script>

/* FINAL DRIVE API */

const API=
"https://script.google.com/macros/s/AKfycbzgKPuIAmuZWOfilOj8gM9qJcZesz3ECPIhpCvBmupKFY2t76_ObVWyylnoTa4ecyda/exec";


let user=
JSON.parse(localStorage.getItem("user"));

if(!user){

alert("Login First");

location.href="login.html";

}


/* ⭐ STAR */

let rating=5;

function setStar(n){

rating=n;

}


/* DB */

async function getDB(db){

let r=
await fetch(
API+"?db="+db+"&t="+Date.now()
);

return await r.json();

}

async function saveDB(db,data){

await fetch(API,{

method:"POST",

headers:{
"Content-Type":"application/json"
},

body:JSON.stringify({

db:db,
data:data

})

});

}


/* SUBMIT REVIEW */

async function submitReview(){

let text=
document.getElementById(
"reviewText"
).value.trim();

if(!text){

alert("Write Review");

return;

}

let reviews=
await getDB("reviews") || [];


/* SAVE */

reviews.push({

user:user.email,

rating:rating,

message:text,

date:new Date()
.toLocaleString()

});


await saveDB(
"reviews",
reviews
);


alert(
"Review Submitted ✅"
);

document.getElementById(
"reviewText"
).value="";

loadReviews();

}


/* LOAD REVIEWS */

async function loadReviews(){

let reviews=
await getDB("reviews") || [];

const box=
document.getElementById(
"reviewList"
);


/* MY REVIEWS */

let my=
reviews.filter(
r=>r.user===user.email
);


if(!my.length){

box.innerHTML=
"No Reviews Yet";

return;

}

box.innerHTML="";


my.reverse()
.forEach(r=>{

box.innerHTML+=`

<div class="review">

⭐ ${r.rating}/5

<br>

${r.message}

<br>

<small>

${r.date}

</small>

</div>

`;

});

}


loadReviews();

</script>

</body>

</html>
