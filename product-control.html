<!DOCTYPE html>
<html lang="en">
<head>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">

<title>Product Control</title>

<style>

body{
margin:0;
font-family:Arial;
background:#020617;
color:white;
}

.topbar{

display:flex;
align-items:center;
padding:14px;
box-shadow:0 5px 20px black;

}

.back{

font-size:22px;
cursor:pointer;
width:40px;

}

.title{

flex:1;
text-align:center;
color:#22c55e;
font-weight:bold;

}

.container{

max-width:1000px;
margin:auto;
padding:20px;

}

.card{

background:#111827;
padding:20px;
border-radius:14px;

}

.row{

background:#020617;
padding:15px;
border-radius:10px;
margin-top:12px;

}

button{

border:none;
padding:8px 14px;
border-radius:8px;
cursor:pointer;
color:white;
margin:5px;

}

.edit{background:orange;}
.delete{background:red;}
.approve{background:#22c55e;}
.reject{background:#ef4444;}

#editBox{

display:none;
position:fixed;
top:0;
left:0;
width:100%;
height:100%;
background:rgba(0,0,0,.8);
overflow:auto;
z-index:99999;

}

.editContent{

background:#111827;
max-width:520px;
margin:40px auto;
padding:20px;
border-radius:12px;

}

input{

width:100%;
padding:12px;
margin-top:10px;
border:none;
border-radius:8px;
background:#020617;
color:white;

}

</style>
</head>

<body>

<div class="topbar">

<div class="back"
onclick="history.back()">

â¬…

</div>

<div class="title">

ðŸ“¦ Product Control

</div>

</div>

<div class="container">

<div class="card">

<h2>All Products</h2>

<div id="products">

Loading...

</div>

</div>

</div>


<!-- EDIT BOX -->

<div id="editBox">

<div class="editContent">

<h2>Edit Ebook</h2>

<input id="eTitle" placeholder="Title">

<input id="ePrice" type="number" placeholder="Price">

<input id="eSeller" placeholder="Seller Email">


<p>Change Cover Image</p>

<input type="file" id="cover" accept="image/*">


<p>Change Ebook PDF</p>

<input type="file" id="pdf" accept="application/pdf">


<button class="approve"

onclick="saveEdit()">

Save âœ…

</button>

<button class="delete"

onclick="deleteEdit()">

Delete Ebook

</button>

<button onclick="closeEdit()">

Cancel

</button>

</div>

</div>


<script>

const ADMIN="ayushprajpati6@gmail.com";

const API="https://script.google.com/macros/s/AKfycbzgKPuIAmuZWOfilOj8gM9qJcZesz3ECPIhpCvBmupKFY2t76_ObVWyylnoTa4ecyda/exec";

let user=JSON.parse(localStorage.getItem("user"));

if(!user||user.email!==ADMIN){

alert("Admin Only");

location.href="index.html";

}


/* DB */

async function getDB(db){

let r=
await fetch(API+"?db="+db+"&t="+Date.now());

return await r.json();

}

async function saveDB(db,data){

await fetch(API,{

method:"POST",

headers:{

"Content-Type":"text/plain"

},

body:JSON.stringify({

db,data

})

});

}


/* DRIVE UPLOAD */

async function uploadDrive(image,pdf){

let r=
await fetch(API,{

method:"POST",

headers:{
"Content-Type":"text/plain"
},

body:JSON.stringify({

action:"uploadFile",

image,

pdf

})

});

return await r.json();

}


/* PRODUCT LOAD */

let editID=null;

async function loadProducts(){

let products=
await getDB("products");

let box=
document.getElementById("products");

box.innerHTML="";


products.reverse().forEach(p=>{

let buttons=`

<button class="edit"

onclick="openEdit(${p.id})">

Edit

</button>

<button class="delete"

onclick="deleteProduct(${p.id})">

Delete

</button>

`;

if(p.status!=="approved"){

buttons+=`

<button class="approve"

onclick="approve(${p.id})">

Approve

</button>

<button class="reject"

onclick="reject(${p.id})">

Reject

</button>

`;

}

box.innerHTML+=`

<div class="row">

<b>${p.title}</b>

<br>

â‚¹${p.price}

<br>

Seller :
${p.owner}

<br>

Status :
${p.status}

<br>

${buttons}

</div>

`;

});

}


/* EDIT OPEN */

async function openEdit(id){

editID=id;

let products=
await getDB("products");

let p=
products.find(x=>Number(x.id)===Number(id));

eTitle.value=p.title;

ePrice.value=p.price;

eSeller.value=p.owner;

editBox.style.display="block";

}

function closeEdit(){

editBox.style.display="none";

}


/* FILE BASE64 */

function fileBase64(file){

return new Promise(resolve=>{

if(!file){

resolve("");

return;

}

let reader=new FileReader();

reader.onload=()=>resolve(reader.result);

reader.readAsDataURL(file);

});

}


/* SAVE EDIT */

async function saveEdit(){

let products=
await getDB("products");

let coverFile=
document.getElementById("cover").files[0];

let pdfFile=
document.getElementById("pdf").files[0];

let image64=
await fileBase64(coverFile);

let pdf64=
await fileBase64(pdfFile);


let upload=null;

if(image64||pdf64){

upload=
await uploadDrive(image64,pdf64);

}


products=
products.map(p=>{

if(Number(p.id)===Number(editID)){

p.title=eTitle.value;

p.price=Number(ePrice.value);

p.owner=eSeller.value;

if(upload){

if(upload.image)

p.image=upload.image;

if(upload.pdf)

p.pdf=upload.pdf;

}

}

return p;

});

await saveDB("products",products);

alert("Updated Successfully âœ…");

closeEdit();

loadProducts();

}


/* DELETE */

async function deleteEdit(){

await deleteProduct(editID);

closeEdit();

}

async function deleteProduct(id){

if(!confirm("Delete Ebook?"))

return;

let products=
await getDB("products");

products=
products.filter(

p=>Number(p.id)!==Number(id)

);

await saveDB("products",products);

loadProducts();

}


/* APPROVE */

async function approve(id){

let products=
await getDB("products");

products=
products.map(p=>{

if(Number(p.id)===Number(id))

p.status="approved";

return p;

});

await saveDB("products",products);

alert("Approved âœ…");

loadProducts();

}


/* REJECT */

async function reject(id){

await deleteProduct(id);

}


/* LOAD */

loadProducts();

</script>

</body>
</html>
