<script>

const API="https://creatorhub-f2fe.onrender.com/api";


// ===== SAFE LOGIN CHECK =====

const token = localStorage.getItem("token");

let user;

try{

user = JSON.parse(localStorage.getItem("user"));

}catch{

localStorage.clear();

location.href="login.html";

}


// à¤…à¤—à¤° user à¤¨à¤¹à¥€à¤‚

if(!token || !user){

alert("Login Required");

location.href="login.html";

}


// ===== USER NAME SAFE =====

document.getElementById("username").innerText=

"Welcome "+(user.name || "Creator")+" ðŸ‘‹";


// ===== PROFILE IMAGE SAFE =====

if(user.email){

const savedImg=

localStorage.getItem(

"profile_"+user.email

);

if(savedImg){

document.getElementById(

"profileImg"

).src=savedImg;

}

}


// ===== PROFILE UPLOAD =====

function uploadProfile(e){

const file=e.target.files[0];

if(!file)return;

const reader=new FileReader();

reader.onload=function(){

localStorage.setItem(

"profile_"+user.email,

reader.result

);

document.getElementById(

"profileImg"

).src=

reader.result;

};

reader.readAsDataURL(file);

}


// ===== NAVIGATION =====

function go(page){

location.href=page;

}


// ===== LOAD STATS =====

async function loadStats(){

try{


const p=await fetch(API+"/products");

const pdata=await p.json();

document.getElementById(

"productCount"

).innerText=

pdata.products?.length || 0;



const o=

await fetch(

API+"/orders",

{

headers:{

Authorization:"Bearer "+token

}

});

const odata=await o.json();

document.getElementById(

"orderCount"

).innerText=

odata.orders?.length || 0;


let total=0;

odata.orders?.forEach(ord=>{

if(ord.product){

total+=ord.product.price||0;

}

});

document.getElementById(

"earnings"

).innerText=total;

}catch(e){

console.log("Stats Error",e);

}

}

loadStats();


// ===== LOGOUT =====

function logout(){

localStorage.clear();

alert("Logged Out");

location.href="login.html";

}

</script>
