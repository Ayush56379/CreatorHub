<script>

document.addEventListener("DOMContentLoaded", async function(){

const API="https://creatorhub-f2fe.onrender.com/api";


// ‚≠ê SAFE TOKEN + USER

const token=localStorage.getItem("token");

let user=null;

try{

user=JSON.parse(localStorage.getItem("user"));

}catch{

user=null;

}


// ‚≠ê LOGIN CHECK (NO ALERT LOOP)

if(!token || !user){

window.location.replace("login.html");

return;

}


// ‚≠ê USER NAME

const username=document.getElementById("username");

if(username){

username.innerText="Welcome "+(user.name || "User")+" üëã";

}


// ‚≠ê PROFILE IMAGE

const profile=document.getElementById("profileImg");

const saved=

localStorage.getItem(

"profile_"+user.email

);

if(profile && saved){

profile.src=saved;

}


// ‚≠ê PROFILE UPLOAD

window.uploadProfile=function(e){

const file=e.target.files[0];

if(!file)return;

const reader=new FileReader();

reader.onload=function(){

localStorage.setItem(

"profile_"+user.email,

reader.result

);

if(profile){

profile.src=reader.result;

}

};

reader.readAsDataURL(file);

};


// ‚≠ê SAFE NAVIGATION

window.go=function(page){

window.location.href=page;

};


// ‚≠ê LOAD STATS

try{

// PRODUCTS

const pres=

await fetch(API+"/products");

const pdata=await pres.json();

const pc=document.getElementById("productCount");

if(pc){

pc.innerText=pdata.products?.length || 0;

}


// ORDERS

const ores=

await fetch(API+"/orders",{

headers:{

Authorization:"Bearer "+token

}

});

const odata=await ores.json();

const oc=document.getElementById("orderCount");

if(oc){

oc.innerText=odata.orders?.length || 0;

}


// EARNINGS

let total=0;

odata.orders?.forEach(ord=>{

if(ord.product){

total+=ord.product.price || 0;

}

});

const earn=document.getElementById("earnings");

if(earn){

earn.innerText=total;

}

}

catch(err){

console.log("Dashboard Error",err);

}

});


// ‚≠ê LOGOUT

function logout(){

localStorage.clear();

window.location.replace("login.html");

}

</script>
