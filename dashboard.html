<script>

document.addEventListener("DOMContentLoaded",()=>{

const API="https://creatorhub-f2fe.onrender.com/api";


// TOKEN + USER SAFE

let token =
localStorage.getItem("token");

let user=null;

try{

user =
JSON.parse(
localStorage.getItem("user")
);

}catch{

user=null;

}


// AUTO LOGIN (TESTING)

if(!token || !user){

localStorage.setItem(
"token",
"creatorhub123"
);

localStorage.setItem(
"user",
JSON.stringify({

name:"CreatorHub User",

email:"user@gmail.com"

})
);

token =
localStorage.getItem("token");

user =
JSON.parse(
localStorage.getItem("user")
);

}


// USER NAME

const usernameEl =
document.getElementById("username");

if(usernameEl && user){

usernameEl.innerText =
"Welcome "+(user.name || "User")+" ðŸ‘‹";

}


// PROFILE IMAGE

const profileEl =
document.getElementById("profileImg");

const savedImg =
localStorage.getItem(

"profile_"+user?.email

);

if(profileEl && savedImg){

profileEl.src=savedImg;

}


// PROFILE UPLOAD

window.uploadProfile=function(e){

const file=e.target.files[0];

if(!file) return;

const reader=new FileReader();

reader.onload=function(){

localStorage.setItem(

"profile_"+user.email,

reader.result

);

if(profileEl){

profileEl.src=reader.result;

}

};

reader.readAsDataURL(file);

};


// NAVIGATION

window.go=function(page){

location.href=page;

};


// LOAD STATS

async function loadStats(){

try{

const p =
await fetch(API+"/products");

const pdata =
await p.json();

const productCountEl =
document.getElementById("productCount");

if(productCountEl){

productCountEl.innerText =
pdata.products?.length || 0;

}


const o =
await fetch(API+"/orders",{

headers:{

Authorization:
"Bearer "+token

}

});

const odata =
await o.json();

const orderCountEl =
document.getElementById("orderCount");

if(orderCountEl){

orderCountEl.innerText =
odata.orders?.length || 0;

}


let total=0;

odata.orders?.forEach(ord=>{

if(ord.product){

total +=
ord.product.price || 0;

}

});

const earnEl =
document.getElementById("earnings");

if(earnEl){

earnEl.innerText=total;

}

}catch(e){

console.log("Stats Error",e);

}

}

loadStats();

});


// LOGOUT

function logout(){

localStorage.removeItem("token");

localStorage.removeItem("user");

location.href="./login.html";

}

</script>
