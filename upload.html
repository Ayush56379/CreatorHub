<!DOCTYPE html>
<html>

<head>

<meta name="viewport"
content="width=device-width,initial-scale=1">

<title>Upload Ebook</title>

<style>

body{
background:#020617;
color:white;
font-family:Arial;
padding:20px;
}

.card{
background:#111827;
padding:20px;
border-radius:15px;
max-width:500px;
margin:auto;
box-shadow:0 0 20px black;
}

input{
width:100%;
padding:14px;
margin-top:12px;
border:none;
border-radius:10px;
background:#020617;
color:white;
}

button{
width:100%;
padding:15px;
margin-top:15px;
background:linear-gradient(
90deg,#f59e0b,#fb923c);
border:none;
border-radius:12px;
font-weight:bold;
cursor:pointer;
color:white;
}

.preview{
width:100%;
margin-top:10px;
border-radius:10px;
display:none;
}

.back{

background:#2563eb;

padding:10px 15px;

border-radius:10px;

display:inline-block;

margin-bottom:15px;

cursor:pointer;

}

</style>

</head>

<body>

<div class="back"

onclick="history.back()">

‚¨Ö Back

</div>


<div class="card">

<h2>

üìò Upload Ebook

</h2>


<input id="title"

placeholder="Ebook Title">


<input id="price"

placeholder="Price ‚Çπ">


<h4>

Choose Cover Image

</h4>

<input type="file"

accept="image/*"

onchange="previewImage(event)">


<img id="preview"

class="preview">


<h4>

Select PDF

</h4>

<input type="file"

accept="application/pdf"

onchange="previewPDF(event)">



<button onclick="uploadBook()">

Upload Ebook üöÄ

</button>

</div>



<script>



// ‚≠ê GOOGLE DRIVE DATABASE API ‚≠ê

const API=

"https://script.google.com/macros/s/AKfycbz_5CJPDBUTQgVEGaFcmQYQ9DK70CxVvvvS9CyVtxKvQC-SUI0RRQzMEsGMIdK_DMok/exec";



let imageBase64="";

let pdfBase64="";



// LOGIN CHECK

const user=

JSON.parse(

localStorage.getItem("user")

);


const token=

localStorage.getItem("token");


if(!user || !token){

alert("Login First");

location.href="login.html";

}



// IMAGE PREVIEW

function previewImage(e){

const file=e.target.files[0];

if(!file)return;


const reader=new FileReader();

reader.onload=function(){

imageBase64=reader.result;

preview.src=imageBase64;

preview.style.display="block";

};

reader.readAsDataURL(file);

}



// PDF LOAD

function previewPDF(e){

const file=e.target.files[0];

if(!file)return;


const reader=new FileReader();

reader.onload=function(){

pdfBase64=reader.result;

};

reader.readAsDataURL(file);

}



// FINAL UPLOAD ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê

async function uploadBook(){


let title=

document.getElementById(

"title"

).value.trim();


let price=

document.getElementById(

"price"

).value.trim();



if(!title||

!price||

!imageBase64||

!pdfBase64){

alert("Fill All Fields");

return;

}


alert("Uploading Ebook...");


try{


// SAVE IMAGE + PDF DRIVE

const upload=

await fetch(

API,

{

method:"POST",

body:JSON.stringify({

action:"upload",

title:title,

image:imageBase64,

pdf:pdfBase64,

owner:user.email

})

});


const data=

await upload.json();


if(!data.success){

alert("Upload Failed");

return;

}



// SAVE PRODUCT JSON

await fetch(

API,

{

method:"POST",

body:JSON.stringify({

action:"saveProduct",

product:{

id:Date.now(),

title:title,

price:Number(price),

image:data.image,

pdf:data.pdf,

owner:user.email

}

})

});


alert("Upload Successful ‚úÖ");


location.href="products.html";


}catch(e){

console.log(e);

alert("Upload Error");

}


}

</script>

</body>

</html>
