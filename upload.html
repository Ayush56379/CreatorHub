<!DOCTYPE html>
<html lang="en">
<head>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">

<title>Upload Ebook - CreatorHub</title>

<style>

body{
margin:0;
font-family:Arial;
background:#020617;
color:white;
}

.topbar{
display:flex;
align-items:center;
padding:14px;
background:#020617;
box-shadow:0 4px 15px rgba(0,0,0,.5);
}

.back{
font-size:22px;
cursor:pointer;
width:40px;
}

.title{
flex:1;
text-align:center;
font-weight:bold;
color:#22c55e;
}

.container{
padding:20px;
}

.card{
background:#111827;
padding:25px;
border-radius:15px;
max-width:520px;
margin:auto;
}

input{
width:100%;
padding:14px;
margin-top:12px;
border:none;
border-radius:10px;
background:#1f2937;
color:white;
}

button{
width:100%;
padding:15px;
margin-top:18px;
background:#f97316;
border:none;
border-radius:10px;
color:white;
font-weight:bold;
cursor:pointer;
}

.preview{
width:100%;
margin-top:10px;
border-radius:10px;
display:none;
}

</style>

</head>

<body>

<div class="topbar">

<div class="back"
onclick="history.back()">

‚¨Ö

</div>

<div class="title">

üìò Upload Ebook

</div>

</div>


<div class="container">

<div class="card">

<h2>Upload Digital Ebook</h2>

<input id="title"
placeholder="Ebook Title">

<input id="price"
type="number"
placeholder="Price ‚Çπ">


<p>Cover Image</p>

<input type="file"
accept="image/*"
onchange="previewImage(event)">

<img id="preview"
class="preview">


<p>Select Ebook PDF</p>

<input type="file"
accept="application/pdf"
onchange="loadPDF(event)">


<button id="uploadBtn"
onclick="uploadBook()">

Upload Ebook üöÄ

</button>

</div>

</div>


<script>

const API="https://script.google.com/macros/s/AKfycbzgKPuIAmuZWOfilOj8gM9qJcZesz3ECPIhpCvBmupKFY2t76_ObVWyylnoTa4ecyda/exec";

let user=JSON.parse(localStorage.getItem("user"));

if(!user){

alert("Login First");

location.href="login.html";

}


/* ‚úÖ SELLER CHECK (NEW ADD) */

async function getDB(db){

let r=
await fetch(API+"?db="+db+"&t="+Date.now());

return await r.json();

}

async function checkSeller(){

let users=await getDB("users")||[];

let me=users.find(
u=>u.email===user.email
);

if(!me){

alert("User Not Found");

location.href="dashboard.html";

return;

}

/* Seller Approved */

if(me.seller===true){

return;

}

/* Applied but waiting */

if(me.sellerRequest===true){

alert("Waiting Admin Approval ‚è≥");

location.href="dashboard.html";

return;

}

/* Not applied */

alert("Apply Seller First ‚≠ê");

location.href="become-seller.html";

}

checkSeller();

/* ====================== */


let imageBase64="";
let pdfBase64="";


function previewImage(e){

let file=e.target.files[0];

if(!file)return;

if(file.size>5*1024*1024){

alert("Image Max 5MB");

return;

}

let reader=new FileReader();

reader.onload=()=>{

imageBase64=reader.result;

preview.src=imageBase64;

preview.style.display="block";

};

reader.readAsDataURL(file);

}


function loadPDF(e){

let file=e.target.files[0];

if(!file)return;

if(file.size>15*1024*1024){

alert("PDF Max 15MB");

return;

}

let reader=new FileReader();

reader.onload=()=>{

pdfBase64=reader.result;

};

reader.readAsDataURL(file);

}


async function saveDB(db,data){

await fetch(API,{

method:"POST",

headers:{
"Content-Type":"text/plain"
},

body:JSON.stringify({

db:db,

data:data

})

});

}



async function uploadBook(){

let btn=
document.getElementById("uploadBtn");

btn.disabled=true;

btn.innerText="Uploading...";


let title=
document.getElementById("title").value.trim();

let price=
document.getElementById("price").value.trim();


if(!title||
!price||
!imageBase64||
!pdfBase64){

alert("Fill All Fields");

btn.disabled=false;

btn.innerText="Upload Ebook üöÄ";

return;

}


try{


let upload=
await fetch(API,{

method:"POST",

headers:{
"Content-Type":"text/plain"
},

body:JSON.stringify({

action:"uploadFile",

image:imageBase64,

pdf:pdfBase64

})

});


let text=
await upload.text();

let result=
JSON.parse(text);


if(!result.success){

alert("Drive Upload Failed");

throw "fail";

}


let products=
await getDB("products")||[];


products.push({

id:Date.now(),

title:title,

price:Number(price),

image:result.image,

pdf:result.pdf,

owner:user.email,

status:"pending",

date:new Date().toLocaleString()

});


await saveDB(
"products",
products
);


alert("Upload Success ‚úÖ");

location.href="products.html";


}catch(e){

alert("Upload Error ‚ùå");

btn.disabled=false;

btn.innerText="Upload Ebook üöÄ";

}

}

</script>

</body>

</html>
