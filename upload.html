<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Upload Ebook - CreatorHub</title>

<style>
:root{
--bg:#ffffff;
--text:#111827;
--card:#f3f4f6;
--accent:#22c55e;
}
@media(prefers-color-scheme:dark){
:root{
--bg:#020617;
--text:#ffffff;
--card:#111827;
}
}
body{
margin:0;
font-family:Arial;
background:var(--bg);
color:var(--text);
}
.topbar{
display:flex;
align-items:center;
padding:14px;
box-shadow:0 5px 20px rgba(0,0,0,.3);
}
.back{
font-size:22px;
cursor:pointer;
width:40px;
}
.title{
flex:1;
text-align:center;
font-weight:bold;
color:var(--accent);
}
.container{padding:20px;}
.card{
background:var(--card);
padding:25px;
border-radius:18px;
max-width:520px;
margin:auto;
}
input{
width:100%;
padding:14px;
margin-top:12px;
border:none;
border-radius:10px;
background:rgba(0,0,0,.06);
color:var(--text);
}
button{
width:100%;
padding:15px;
margin-top:18px;
background:linear-gradient(90deg,#f59e0b,#f97316);
border:none;
border-radius:12px;
color:white;
font-weight:bold;
cursor:pointer;
}
.preview{
width:100%;
margin-top:12px;
border-radius:12px;
display:none;
}
</style>
</head>

<body>

<div class="topbar">
<div class="back" onclick="history.back()">‚¨Ö</div>
<div class="title">üìò Upload Ebook</div>
</div>

<div class="container">
<div class="card">

<h2>Upload Digital Ebook</h2>

<input id="title" placeholder="Ebook Title">
<input id="price" type="number" placeholder="Price ‚Çπ">

<p>Cover Image (Max 5MB)</p>
<input type="file" accept="image/*" onchange="previewImage(event)">
<img id="preview" class="preview">

<p>Select Ebook PDF (Max 15MB)</p>
<input type="file" accept="application/pdf" onchange="loadPDF(event)">

<button id="uploadBtn" onclick="uploadBook()">Upload Ebook üöÄ</button>

</div>
</div>

<script>

const API = "https://script.google.com/macros/s/AKfycbzgKPuIAmuZWOfilOj8gM9qJcZesz3ECPIhpCvBmupKFY2t76_ObVWyylnoTa4ecyda/exec";

let user = JSON.parse(localStorage.getItem("user"));

if(!user){
alert("Login First");
location.href="login.html";
}

let imageBase64="";
let pdfBase64="";

function previewImage(e){
let file=e.target.files[0];
if(!file) return;
if(file.size>5*1024*1024){
alert("Image max 5MB");
return;
}
let reader=new FileReader();
reader.onload=()=>{
imageBase64=reader.result;
document.getElementById("preview").src=imageBase64;
document.getElementById("preview").style.display="block";
};
reader.readAsDataURL(file);
}

function loadPDF(e){
let file=e.target.files[0];
if(!file) return;
if(file.size>15*1024*1024){
alert("PDF max 15MB");
return;
}
let reader=new FileReader();
reader.onload=()=>{
pdfBase64=reader.result;
};
reader.readAsDataURL(file);
}

async function getDB(db){
try{
let r=await fetch(API+"?db="+db+"&t="+Date.now());
return await r.json();
}catch(err){
console.log("GET DB ERROR:",err);
return [];
}
}

async function saveDB(db,data){
await fetch(API,{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({db:db,data:data})
});
}

async function uploadBook(){

let btn=document.getElementById("uploadBtn");
btn.disabled=true;
btn.innerText="Uploading...";

let title=document.getElementById("title").value.trim();
let price=document.getElementById("price").value.trim();

if(!title||!price||!imageBase64||!pdfBase64){
alert("Fill All Fields");
btn.disabled=false;
btn.innerText="Upload Ebook üöÄ";
return;
}

try{

let upload=await fetch(API,{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({
action:"uploadFile",
image:imageBase64,
pdf:pdfBase64
})
});

let result=await upload.json();
console.log("UPLOAD RESPONSE:",result);

if(!result.success){
alert("Drive Upload Failed: "+(result.error||"Unknown Error"));
throw "Upload Failed";
}

let products=await getDB("products");

products.push({
id:Date.now(),
title:title,
price:Number(price),
image:result.image,
pdf:result.pdf,
owner:user.email,
status:"pending",
date:new Date().toLocaleString()
});

await saveDB("products",products);

alert("Upload Successful ‚úÖ");
location.href="products.html";

}catch(e){
console.log("UPLOAD ERROR:",e);
alert("Upload Error ‚ùå Check Console");
btn.disabled=false;
btn.innerText="Upload Ebook üöÄ";
}

}

</script>

</body>
</html>
